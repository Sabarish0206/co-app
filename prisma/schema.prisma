generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id       String @id @default(cuid())
  name     String
  email    String @unique
  password String
  role     Role
}

model Subject {
  id         String          @id @default(cuid())
  name       String
  code       String          @unique
  exams      Exam[]
  questions  Question[]
}

model CO {
  id          String          @id @default(cuid())
  name        Int
  description String?
  examId      String
  exam        Exam            @relation(fields:[examId],references:[id])
  questions   Question[]
  studentCOs  StudentCOMark[]

  @@unique([name,examId])
}

model Exam {
  id        String     @id @default(cuid())
  name      ExamName
  subjectId String
  year      Int
  subject   Subject    @relation(fields: [subjectId], references: [id])
  semester  Int
  questions Question[]
  cos        CO[]    
  studentCOs StudentCOMark[] 

  @@unique([subjectId, name, year,semester])  
}

model Question {
  id           String        @id @default(cuid())
  no           Int
  option       String?
  subDivision  String?
  text         String
  marks        Int
  coId         String?
  pi           String?
  bl           String?
  subjectId    String
  examId       String

  co           CO?            @relation(fields: [coId], references: [id])
  exam         Exam          @relation(fields: [examId], references: [id])
  subject      Subject       @relation(fields: [subjectId], references: [id])
  studentMarks StudentMark[]

  @@unique([no,subDivision,option,examId])
}

model Student {
  id           String          @id @default(cuid())
  name         String
  rollNumber   String          @unique
  year         Year
  sec          String
  department   Department      @default(CSE)
  studentCOs   StudentCOMark[]
  studentMarks StudentMark[]
}

model StudentMark {
  id         String   @id @default(cuid())
  studentId  String
  questionId String
  marks      Int
  question   Question @relation(fields: [questionId], references: [id])
  student    Student  @relation(fields: [studentId], references: [id])
}

model StudentCOMark {
  id        String  @id @default(cuid())
  studentId String
  coId      String
  examId String
  marks     Int
  coTotal   Int
  co        CO      @relation(fields: [coId], references: [id])
  student   Student @relation(fields: [studentId], references: [id])
  exam      Exam @relation(fields: [examId], references: [id])
}

enum Role {
  faculty
  admin
}

enum ExamName {
  SerialTest1
  SerialTest2
  SerialTest3
  oddSem
  evenSem
}

enum Year {
  I
  II
  III
  IV
}

enum Department {
  CSE
  IT
  MECH
  CIVIL
  BME
  EEE
  ECE
  AIDS
  CSBS
}
